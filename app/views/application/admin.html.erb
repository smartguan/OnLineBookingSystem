<html>
<head>
<script type='text/javascript' src='http://code.jquery.com/jquery-1.4.2.js'></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.min.js"></script>
<script type="text/javascript" src="/assets/admin.js"></script>
<script type="text/javascript" src="/assets/jquery.loadJSON.js"></script>
<!-- required plugins -->
        <script type="text/javascript" src="/assets/date.js"></script>
        <!--[if lt IE 7]><script type="text/javascript" src="scripts/jquery.bgiframe.min.js"></script><![endif]-->
        
        <!-- jquery.datePicker.js -->
        <script type="text/javascript" src="/assets/jquery.datePicker.js"></script>
        
        <!-- datePicker required styles -->
        <link rel="stylesheet" type="text/css" media="screen" href="/assets/datePicker.css">
<link rel="stylesheet" type="text/css" href="/assets/admin.css">
</head>

<center>
<h1>Page for stupid Admins</h1>
</center>

</div id="main-page">
<center>

    <div id="new-button">
        <button>Add Section</button>
    </div>
</div>

<div id="mytable" class='imagetable'>
</div>

<div id="new-form" class="new-box">
    <h1>Create Section</h1>
    <form>
        <label for="addname">Name</label>
        <input type="text" name="add-name" id="add-name">
        <br>
        <label for="addstartdate">Start Date</label>
        <input type="text" name="add-start-date" id="add-start-date" class="date-pick">
        <br>
        <label for="addenddate">End Date</label>
        <input type="text" name="add-end-date" id="add-end-date" class="date-pick">
        <br>
        <label for="addday">Day</label>
        <select type="text" name="add-day" id="add-day">
            <option value="Sunday">Sunday</option>
            <option value="Monday">Monday</option>
            <option value="Tuesday">Tuesday</option>
            <option value="Wednesday">Wednesday</option>
            <option value="Thursday">Thursday</option>
            <option value="Friday">Friday</option>
            <option value="Saturday">Saturday</option>
        </select>
        <br>
        <label for="addstarttime">Start Time</label>
        <select type="time" name="add-start-time" id="add-start-time">
            <option value="8:00AM">8:00AM</option>
            <option value="9:00AM">9:00AM</option>
            <option value="10:00AM">10:00AM</option>
            <option value="11:00AM">11:00AM</option>
            <option value="12:00PM">12:00PM</option>
            <option value="1:00PM">1:00PM</option>
            <option value="2:00PM">2:00PM</option>
            <option value="3:00PM">3:00PM</option>
            <option value="4:00PM">4:00PM</option>
            <option value="5:00PM">5:00PM</option>
            <option value="6:00PM">6:00PM</option>
            <option value="7:00PM">7:00PM</option>
            <option value="8:00PM">8:00PM</option>
            <option value="9:00PM">9:00PM</option>
        </select>
        <br>
        <label for="addendtime">End Time</label>
        <select type="time" name="add-end-time" id="add-end-time">
            <option value="8:00AM">8:00AM</option>
            <option value="9:00AM">9:00AM</option>
            <option value="10:00AM">10:00AM</option>
            <option value="11:00AM">11:00AM</option>
            <option value="12:00PM">12:00PM</option>
            <option value="1:00PM">1:00PM</option>
            <option value="2:00PM">2:00PM</option>
            <option value="3:00PM">3:00PM</option>
            <option value="4:00PM">4:00PM</option>
            <option value="5:00PM">5:00PM</option>
            <option value="6:00PM">6:00PM</option>
            <option value="7:00PM">7:00PM</option>
            <option value="8:00PM">8:00PM</option>
            <option value="9:00PM">9:00PM</option>
        </select>
        <br>
        <label for="addteacher">Teacher</label>
        <input type="text" name="add-teacher" id="add-teacher">
        <br>
        <label for="addmaxenroll">Class capacity</label>
        <input type="integer" name="add-max-enroll" id="add-max-enroll">
        <br>
        <label for="addmaxwaitlist">Waitlist capacity</label>
        <input type="integer" name="add-max-waitlist" id="add-max-waitlist">
        <br>
        <label for="adddescription">Description</label>
        <input type="text" name="add-description" id="add-description">
        <br>
    </form>
    <div id="add_submit-button" class="submit_button" type="submit">
        <button>Submit</button>
    </div>
</div>

<div id="edit-form" class="new-box">
    <h1>Edit Section</h1>
    <form>
        <label for="editname">Name</label>
        <input type="text" name="name" id="name">
        <br>
        <label for="editstartdate">Start Date</label>
        <input type="text" name="start_date" id="start_date" class="date-pick">
        <br>
        <label for="editenddate">End Date</label>
        <input type="text" name="end_date" id="end_date" class="date-pick">
        <br>
        <label for="editday">Day</label>
        <select type="text" name="day" id="day">
            <option value="Sunday">Sunday</option>
            <option value="Monday">Monday</option>
            <option value="Tuesday">Tuesday</option>
            <option value="Wednesday">Wednesday</option>
            <option value="Thursday">Thursday</option>
            <option value="Friday">Friday</option>
            <option value="Saturday">Saturday</option>
        </select>
        <br>
        <label for="editstarttime">Start Time</label>
        <select type="time" name="start_time" id="start_time">
            <option value="8:00AM">8:00AM</option>
            <option value="9:00AM">9:00AM</option>
            <option value="10:00AM">10:00AM</option>
            <option value="11:00AM">11:00AM</option>
            <option value="12:00PM">12:00PM</option>
            <option value="1:00PM">1:00PM</option>
            <option value="2:00PM">2:00PM</option>
            <option value="3:00PM">3:00PM</option>
            <option value="4:00PM">4:00PM</option>
            <option value="5:00PM">5:00PM</option>
            <option value="6:00PM">6:00PM</option>
            <option value="7:00PM">7:00PM</option>
            <option value="8:00PM">8:00PM</option>
            <option value="9:00PM">9:00PM</option>
        </select>
        <br>
        <label for="editendtime">End Time</label>
        <select type="time" name="end_time" id="end_time">
            <option value="8:00AM">8:00AM</option>
            <option value="9:00AM">9:00AM</option>
            <option value="10:00AM">10:00AM</option>
            <option value="11:00AM">11:00AM</option>
            <option value="12:00PM">12:00PM</option>
            <option value="1:00PM">1:00PM</option>
            <option value="2:00PM">2:00PM</option>
            <option value="3:00PM">3:00PM</option>
            <option value="4:00PM">4:00PM</option>
            <option value="5:00PM">5:00PM</option>
            <option value="6:00PM">6:00PM</option>
            <option value="7:00PM">7:00PM</option>
            <option value="8:00PM">8:00PM</option>
            <option value="9:00PM">9:00PM</option>
        </select>
        <br>
        <label for="editteacher">Teacher</label>
        <input type="text" name="teacher" id="teacher">
        <br>
        <label for="editmaxenroll">Class capacity</label>
        <input type="integer" name="enroll-max" id="enroll_max">
        <br>
        <label for="editmaxwaitlist">Waitlist capacity</label>
        <input type="integer" name="waitlist-max" id="waitlist_max">
        <br>
        <label for="editdescription">Description</label>
        <input type="text" name="description" id="description">
        <br>
    </form>
    <div id="edit_submit-button" class="submit_button" type="submit">
        <button>Submit</button>
    </div>
</div>

</center>
<br />

<script type="text/javascript">

$('#main-page').hide();
$('#new-form').hide();

/* setup the page so that only one of the forms is shown */
$(document).ready(function() {
    init_data();
   show_login_page();
 });

function show_login_page() {
  $('#main-page').show();
  $('#new-form').hide();
  $('#edit-form').hide();
}

function refresh_after_create() {
    $('#main-page').show();
    $('#new-form').hide();
}

function toggle_new_form() {
  $('#new-form').toggle(); 
}

$('#new-button').click(function() {
    toggle_new_form();
})

$('#add_submit-button').click(function() {
    name = $('#add-name').val()
    start_date = $('#add-start-date').val()
    end_date = $('#add-end-date').val()
    day = $('#add-day').val()
    start_time = $('#add-start-time').val()
    end_time = $('#add-end-time').val()
    teacher = $('#add-teacher').val()
    enroll_max = $('#add-max-enroll').val()
    waitlist_max = $('#add-max-waitlist').val()
    description = $('#add-description').val()

    post_json_request("/Admin/createSection", { name: name, start_date: start_date, end_date: end_date, day: day, start_time: start_time, end_time: end_time, teacher: teacher, enroll_cur: 0, enroll_max: enroll_max, waitlist_cur: 0, waitlist_max: waitlist_max, description: description }, function(data) { return handle_add_response(data); });
});

$('#edit_submit-button').click(function() {
    name = $('#name').val()
    start_date = $('#start_date').val()
    end_date = $('#end_date').val()
    day = $('#day').val()
    start_time = $('#start_time').val()
    end_time = $('#end_time').val()
    teacher = $('#teacher').val()
    enroll_max = $('#enroll_max').val()
    waitlist_max = $('#waitlist_max').val()
    description = $('#description').val()

    post_json_request("/Admin/editSection", { name: name, start_date: start_date, end_date: end_date, day: day, start_time: start_time, end_time: end_time, teacher: teacher, enroll_cur: 0, enroll_max: enroll_max, waitlist_cur: 0, waitlist_max: waitlist_max, description: description }, function(data) { return handle_add_response(data); });
});


/* Takes a dictionary to be JSON encoded, calls the success
   function with the diction decoded from the JSON response.*/
function post_json_request(page, dict, success) {
  $.ajax({
    type: 'POST',
    url: page,
    data: JSON.stringify(dict),
    contentType: "application/json",
    dataType: "json",
    success: success
  });
}

function get_json_request(page, dict, success) {
  $.ajax({
    type: 'GET',
    url: page,
    data: JSON.stringify(dict),
    contentType: "application/json",
    dataType: "json",
    success: success
  });
}

function handle_add_response(data) {
  if (data.errCode == 1) {
    $('#new-form').hide();
    $('#mytable').fadeOut('slow', function() {
        post_json_request("/Registrations/getSchedule", {}, function(data) {loadingBody(data)});
        $('#mytable').fadeIn('fast');
    })
    //post_json_request("/Registrations/getSchedule", {}, function(data) {loadingBody(data)});
    $('form').clearForm();
  } else if (data.errCode == 200) {
    alert('Invalid name, try again.');
  }
}

function handle_edit_response(data) {
    if (data.errCode == 1) {
    $('#edit-form').loadJSON(data.sections);
    //post_json_request("/Registrations/getSchedule", {}, function(data) {loadingBody(data)});
    $('#edit-form').show();
  } else if (data.errCode == 200) {
    alert('Invalid name, try again.');
  }
}

function init_data() {
    post_json_request("/Registrations/getSchedule", {}, function(data) {loadingBody(data)})
}

function loadingBody(data){
    if (data.errCode == 300) {
        document.getElementById('mytable').innerHTML='No records found!';
    } else {
        var json = data.sections
        if(json.length > 0){
            displayData(json);
        } else {
            document.getElementById('mytable').innerHTML='No records found!';
        }
    }
}

function createTableRowContent(rowObject, data, cellType){
    var rowContent = document.createElement(cellType);
    var cell = document.createTextNode(data);
    rowContent.appendChild(cell);
    rowObject.appendChild(rowContent);
}

function createTableData(rowObject, data){
    createTableRowContent(rowObject, data, 'td');
}

function createTableHeader(rowObject, data){
    createTableRowContent(rowObject, data, 'th');
}

function displayData(jsonString){
    
    var table = document.createElement('table');
    //table.border = "1";
    //set table style
   
    table.style.fontFamily = "verdana", "arial", "sans-serif";
    table.style.fontSize = "11px";
    table.style.textAlign = "center";
    table.style.color = "#333333";
    table.style.borderWidth = "1px";
    table.style.borderColor = "#222222";
    table.style.cellSpacing = "0";

    var thead = document.createElement('thead');
    thead.style.background = "#b5cfd2";
    thead.style.borderWidth = "1px";
    thead.style.padding = "8px"
    thead.style.borderStyle = "solid";
    thead.style.borderColor = "#222222";
    thead.style.textAlign = "center";

    table.appendChild(thead);

    var row = document.createElement('tr');
        row.style.background = "#dcddc0";
        row.style.borderWidth = "1px";
        row.style.padding = "8px";
        row.style.borderStyle = "solid";
        row.style.borderColor = "#222222";
        row.style.textAlign = "center";

    createTableHeader(thead, 'Name');
    createTableHeader(thead, 'Start Date');
    createTableHeader(thead, 'End Date');
    createTableHeader(thead, 'Day');
    createTableHeader(thead, 'Start Time');
    createTableHeader(thead, 'End Time');
    createTableHeader(thead, 'Teacher');
    createTableHeader(thead, 'Current Enrollment');
    createTableHeader(thead, 'Max Enrollment');
    createTableHeader(thead, 'Current Waitlist');
    createTableHeader(thead, 'Max Waitlist');
    createTableHeader(thead, 'Description');
    createTableHeader(thead, 'Actions');
    
    thead.appendChild(row);
    
    var tbody = document.createElement('tbody');
    table.appendChild(tbody);
    
    for(i=0; i<jsonString.length; i++){
        var row = document.createElement('tr');
        row.style.background = "#dcddc0";
        row.style.borderWidth = "1px";
        row.style.padding = "8px";
        row.style.borderStyle = "solid";
        row.style.borderColor = "#222222";
        row.style.textAlign = "center";

        createTableData(row, jsonString[i].name);
        createTableData(row, parseDate(jsonString[i].start_date));
        createTableData(row, parseDate(jsonString[i].end_date));
        createTableData(row, jsonString[i].day);
        createTableData(row, parseTime(jsonString[i].start_time));
        createTableData(row, parseTime(jsonString[i].end_time));
        createTableData(row, jsonString[i].teacher);
        createTableData(row, jsonString[i].enroll_cur);
        createTableData(row, jsonString[i].enroll_max);
        createTableData(row, jsonString[i].waitlist_cur);
        createTableData(row, jsonString[i].waitlist_max);
        createTableData(row, jsonString[i].description);

        var bt = document.createElement('input');
        bt.type = 'button';
        bt.name = 'delete-section';
        bt.id = 'delete-section';
        bt.value = 'Delete';
        bt.style.width = '50px';
        bt.onclick = function() {post_json_request("/Admin/deleteSection", { name: $(this).closest('tr').children('td:first').text() }, function(data) { return handle_add_response(data); });};
        //bt.onclick = function() {alert($(this).closest('tr').children('td:first').text())};
        
        var bte = document.createElement('input');
        bte.type = 'button';
        bte.name = 'edit-section';
        bte.id = 'edit-section';
        bte.value = 'Edit';
        bte.style.width = '50px';
        bte.onclick = function() {post_json_request("/Registrations/viewOneSection", { name: $(this).closest('tr').children('td:first').text() }, function(data) { return handle_edit_response(data); });};

        row.appendChild(bt);
        row.appendChild(bte);

        tbody.appendChild(row);
        

        
    }

    document.getElementById('mytable').innerHTML = '';
    document.getElementById('mytable').appendChild(table);
}

function editSection() {

}

function parseTime(timeIn) {
    time = timeIn.split('T')[1].split('Z')[0].split(':')
    var timeEnd = 'AM';
    var hour = 0;
    var min = 0;
    if (time[0] > 12 && time[0] > 22) {
        timeEnd = 'PM';
        hour = time[0] - 12;
    } else if (time[0] > 12) {
        timeEnd = 'PM';
        hour = '0' + time[0] - 12;
    } else if (time[0] == '00') {
        hour = 12;
    } else {
        hour = time[0] % 12;
    }
    min = time[1];

    return (hour + ':' + min + timeEnd);  
}

function parseDate(dateIn) {
    date = dateIn.split('-');
    return (date[1] + '-' + date[2] + '-' + date[0]);
}


//Date.firstDayOfWeek = 0;
//Date.format = 'mm/dd/yyyy';
$(function()
{
    $('.date-pick').datePicker();
});

$.fn.clearForm = function() {
  return this.each(function() {
    var type = this.type, tag = this.tagName.toLowerCase();
    if (tag == 'form')
      return $(':input',this).clearForm();
    if (type == 'text' || type == 'password' || tag == 'textarea')
      this.value = '';
    else if (type == 'checkbox' || type == 'radio')
      this.checked = false;
    else if (tag == 'select')
      this.selectedIndex = -1;
  });
};

</script>
</html>